---
name: verify-loop
description: 자율 작업 루프에서 자기 수정 동작의 가이드라인. 4-Level Completion Criteria, 재시도 전략, 루프 탈출 조건을 정의. Use when running autonomous execution loops (Ralph Loop, Autopilot) that need structured verify-fix cycles.
disable-model-invocation: true
source: origin
---

# 검증 루프 (Verify Loop)

> @-tracking: `bash .cursor/hooks/usage-tracker.sh skills verify-loop`

자율 작업 루프의 자기 수정 동작 가이드라인.

## 자기 수정 루프 흐름

```
Execute (구현)
    ↓
Verify (검증)
    ↓
[이슈 있음?] ─Yes→ Analyze (원인 분석) → Fix (수정) → Execute (재시도)
    │
    No
    ↓
Complete (완료)
```

각 반복에서 이전 실패 원인을 반영하고, 동일 접근을 두 번 사용하지 않는다.

## 4단계 완료 기준

### Level 1 (Minimal)
- 코드 변경 완료
- Lint 통과, ReadLints 오류 0개
- 기본 문법/타입 검사 통과
- 런타임 에러 없음
- 적용: 단순 수정, 짧은 작업

### Level 2 (Standard)
- Level 1 충족
- 기능 검증 완료 (동작 확인)
- Reviewer 승인 (코드 리뷰 기준 충족)
- 논리적 정확성 확인
- 적용: 일반 작업, 버그 수정

### Level 3 (Thorough)
- Level 2 충족
- 모든 테스트 통과
- 엣지 케이스 처리
- 문서화 갱신
- QA 검증 기준 충족
- 적용: 기능 구현, 리팩토링

### Level 4 (Production)
- Level 3 충족
- 보안 검토
- 성능 검증
- 통합 테스트
- 적용: 릴리즈, 배포 전

## 재시도 전략

### 원인 분석 필수
검증 실패 시 즉시 수정하지 않고, 반드시 원인을 먼저 분석한다:
- 무엇이 실패했는가 (증상)
- 왜 실패했는가 (근본 원인)
- 이전 시도에서 무엇이 잘못되었는가
- 다음 시도에서 무엇을 다르게 할 것인가

### 동일 접근 금지
- 같은 방식으로 재시도하지 않는다
- 같은 에러가 2회 반복되면 근본적으로 다른 접근법 시도
- 접근 변경 예: 직접 구현 실패 → 기존 유사 코드 참조

### 오류 유형별 최대 재시도
- 컴파일 에러: 유사 패턴 2회까지
- 동일 에러 3회 연속: 접근 전환
- 총 5회 재시도: 사용자 에스컬레이션

### 유사 에러 시
- 지수적 백오프: 재시도 간격 확대
- 같은 패턴 반복 시 접근 전환

## 루프 탈출 조건

### 정상 종료
- 선택한 Level의 모든 기준 충족

### 강제 종료 (에스컬레이션)
- 동일 오류 3회 연속 → 접근 전환
- 총 5회 재시도 → 사용자 에스컬레이션
- 토큰 예산 초과 → note 스킬로 상태 저장
- 파괴적 변경 필요 시 사용자 확인
- 요구사항 모호 시 사용자 확인

### 강제 종료 보고 형식

```
[Verify Loop 강제 종료]

- 반복 횟수: N/M
- 탈출 사유: [사유]
- 최종 상태: [달성한 것 / 미달성한 것]
- 발견된 이슈: [목록]
- 권장 조치: [사용자에게 제안]
```

## 실패 패턴 분류 및 대응

| 패턴 | 가능 원인 | 대응 |
|------|----------|------|
| 컴파일 에러 | import 누락, 문법 | import/문법 수정 |
| 타입 에러 | 타입 불일치 | 실제 타입 정의 확인 후 수정 |
| 로직 에러 | 요구사항 오해 | 요구사항 재분석 |
| 테스트 실패 | 기대값 불일치 | 테스트 기대값 확인 |
| 빌드 설정 에러 | 프로젝트 설정 | project 설정 확인 |

| 패턴 | 인식 기준 | 대응 전략 |
|------|----------|----------|
| 심볼 미존재 | 타입/메서드 참조 에러 반복 | Grep으로 실제 심볼 검색 후 교체 |
| 패턴 불일치 | 아키텍처 규칙 위반 | 룰 파일 재독, 기존 구현 참조 |
| 의존성 누락 | import/DI 에러 | 의존성 그래프 분석 후 추가 |
| 순환 참조 | 메모리/구조 경고 | 참조 방향 재설계 |

## 반복 간 컨텍스트 전달

### 유지할 것
- 이전 시도의 실패 원인
- 발견된 코드베이스 정보 (심볼, 패턴, 관계)
- 적용한 수정 사항
- 남은 이슈 목록

### 버릴 것
- 실패한 접근 방식의 상세
- 검증된 잘못된 가정

## 성능 원칙

- 최소 수정: 수정 사이클에서는 최소한의 변경만 수행
- 과도한 설계 금지: 수정 중에는 오버엔지니어링 지양
- 병렬 실행: 독립 작업은 병렬 수행
- Fail Fast: 조기 실패 시 불필요한 후속 단계 건너뜀
- 검증 범위: Level 1 통과 후 상위 Level로 확대
